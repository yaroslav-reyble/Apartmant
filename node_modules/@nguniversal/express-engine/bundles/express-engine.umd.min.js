!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("fs"),require("tslib"),require("@angular/compiler"),require("@angular/core"),require("@angular/platform-server"),require("@nguniversal/express-engine/tokens")):"function"==typeof define&&define.amd?define("@nguniversal/express-engine",["exports","fs","tslib","@angular/compiler","@angular/core","@angular/platform-server","@nguniversal/express-engine/tokens"],r):r(((e=e||self).nguniversal=e.nguniversal||{},e.nguniversal.expressEngine={}),e.fs,e.tslib,e.ng.compiler,e.ng.core,e.ng.platformServer,e.nguniversal.expressEngine.tokens)}(this,(function(e,r,t,n,o,i,s){"use strict";var a=function(){function e(){}return e.prototype.get=function(e){return new Promise((function(t,n){r.readFile(e,(function(e,r){if(e)return n(e);t(r.toString())}))}))},e}(),u=function(){function e(e,r){void 0===r&&(r=[]),this.moduleOrFactory=e,this.providers=r,this.factoryCacheMap=new Map,this.templateCache={}}return e.prototype.getCompiler=function(){return i.platformDynamicServer().injector.get(o.CompilerFactory).createCompiler([{providers:[{provide:n.ResourceLoader,useClass:a,deps:[]}]}])},e.prototype.render=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r,n,o;return t.__generator(this,(function(s){switch(s.label){case 0:return(r=e.document)?[3,2]:[4,this.getDocument(e.documentFilePath)];case 1:r=s.sent(),s.label=2;case 2:return n=t.__spread(e.providers||[],this.providers||[],[{provide:i.INITIAL_CONFIG,useValue:{document:r,url:e.url}}]),[4,this.getFactory(this.moduleOrFactory||e.bootstrap)];case 3:return o=s.sent(),[2,i.renderModuleFactory(o,{extraProviders:n})]}}))}))},e.prototype.getFactory=function(e){return t.__awaiter(this,void 0,void 0,(function(){var r,n;return t.__generator(this,(function(t){switch(t.label){case 0:return e instanceof o.NgModuleFactory?[2,e]:[3,1];case 1:return(r=this.factoryCacheMap.get(e))?[2,r]:[4,this.getCompiler().compileModuleAsync(e)];case 2:return n=t.sent(),this.factoryCacheMap.set(e,n),[2,n]}}))}))},e.prototype.getDocument=function(e){var t=this.templateCache[e]=this.templateCache[e]||r.readFileSync(e).toString();return Promise.resolve(t)},e}(),c={};
/**
     * @license
     * Copyright Google LLC All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://angular.io/license
     */
/**
     * @license
     * Copyright Google LLC All Rights Reserved.
     *
     * Use of this source code is governed by an MIT-style license that can be
     * found in the LICENSE file at https://angular.io/license
     */
e.ngExpressEngine=function l(e){var t=new u(e.bootstrap,e.providers);return function(n,o,i){try{if(!e.bootstrap&&!o.bootstrap)throw new Error("You must pass in a NgModule or NgModuleFactory to be bootstrapped");var a=o.req,u=Object.assign({},o);u.url=o.url||a.protocol+"://"+(a.get("host")||"")+a.originalUrl,u.document=o.document||function l(e){return c[e]=c[e]||r.readFileSync(e).toString()}(n),u.providers=o.providers||[],u.providers=u.providers.concat(function p(e,r){var t=[{provide:s.REQUEST,useValue:e}];return r&&t.push({provide:s.RESPONSE,useValue:r}),t}(o.req,o.res)),t.render(u).then((function(e){return i(null,e)})).catch(i)}catch(e){i(e)}}},Object.defineProperty(e,"__esModule",{value:!0})}));